$(function () {
    var data = [
     {
        marketprice:2222,
         img:"https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4017168983,2353441090&fm=26&gp=0.jpg",
         name:"唐人街探案会员卡",
         price:2000,
         id:1,
         list:
        [
         
            {
                id: "3",
                img: "http://img5.imgtn.bdimg.com/it/u=3040533817,4021064804&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "4",
                img: "http://img5.imgtn.bdimg.com/it/u=3040533817,4021064804&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "5",
                img: "http://img1.imgtn.bdimg.com/it/u=1541184195,1793134888&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "6",
                img: "http://img3.imgtn.bdimg.com/it/u=2810888638,446674985&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "7",
                img: "http://img1.imgtn.bdimg.com/it/u=138574545,4174835840&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "8",
                img: "http://img0.imgtn.bdimg.com/it/u=2425599493,534460427&fm=11&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "9",
                img: "http://img3.imgtn.bdimg.com/it/u=2565983383,1443179762&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "10",
                img: "http://img5.imgtn.bdimg.com/it/u=1053998594,976399719&fm=11&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "0",
                img: "https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4017168983,2353441090&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
        ]
     },
     {
        marketprice:2222,
         img:"http://img5.imgtn.bdimg.com/it/u=1053998594,976399719&fm=11&gp=0.jpg",
        name:"私人订制会员卡",
         price:3000,
         id:2,
         list:
        [
            {
                id: "1",
                img: "http://img1.imgtn.bdimg.com/it/u=3467666162,3760167117&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "2",
                img: "http://img0.imgtn.bdimg.com/it/u=3520380256,1318207566&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "6",
                img: "http://img3.imgtn.bdimg.com/it/u=2810888638,446674985&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "7",
                img: "http://img1.imgtn.bdimg.com/it/u=138574545,4174835840&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "8",
                img: "http://img0.imgtn.bdimg.com/it/u=2425599493,534460427&fm=11&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "9",
                img: "http://img3.imgtn.bdimg.com/it/u=2565983383,1443179762&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "10",
                img: "http://img5.imgtn.bdimg.com/it/u=1053998594,976399719&fm=11&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "0",
                img: "https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4017168983,2353441090&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
        ]
     }, {
        marketprice:2222,
         img:"http://img3.imgtn.bdimg.com/it/u=2565983383,1443179762&fm=26&gp=0.jpg",
        name:"功夫会员卡",
         price:4000,
         id:3,
         list:
        [
            {
                id: "1",
                img: "http://img1.imgtn.bdimg.com/it/u=3467666162,3760167117&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "2",
                img: "http://img0.imgtn.bdimg.com/it/u=3520380256,1318207566&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "3",
                img: "http://img5.imgtn.bdimg.com/it/u=3040533817,4021064804&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "4",
                img: "http://img5.imgtn.bdimg.com/it/u=3040533817,4021064804&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "5",
                img: "http://img1.imgtn.bdimg.com/it/u=1541184195,1793134888&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "6",
                img: "http://img3.imgtn.bdimg.com/it/u=2810888638,446674985&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "10",
                img: "http://img5.imgtn.bdimg.com/it/u=1053998594,976399719&fm=11&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
            {
                id: "0",
                img: "https://dss1.bdstatic.com/70cFuXSh_Q1YnxGkpoWK1HF6hhy/it/u=4017168983,2353441090&fm=26&gp=0.jpg",
                name: "阿甘正传",
                price: 100,
                vipprice:80,
                marketprice:120
            },
        ]
     },
    ]
   
    if(data.length>0&&data[0].list){
        $("#card-wrapper").css("display","block")
        initMySlider(data)
    }else if(data.length>0){
        $("#item-wrapper").css("display","block")
        initMySlider(data,true)
    }
    initSwiper()
    initFullPicture()
    function initSwiper() {
        var mySwiper = new Swiper('.swiper-container', {
            loop: true,
            effect: 'fade',
        })
    }
    function initFullPicture() {
        var ss = new shopSlide([], {
            custom: ".cm-img-item img"
        })
        //获取所有图片
        $(".cm-imgs img,.pd-header .pdh-4 img").tap(function () {
            var imgs = $(this).parent().parent().find("img")
            var imgUrls = [];
            var idx = 0
            var curSrc = this.src
            imgs.each(function (i, e) {

                if (e.src == curSrc) {
                    idx = i
                }
                var url = e.src;
                imgUrls.push(url)
            })

            ss.changeImg(imgUrls, idx)

        })

        $("#swiper1 img").tap(function () {
            var curSrc = this.src ? this.src : this.dataset.src
            var imgUrls = []
            var idx = 0
            $("#swiper1 img").each(function (i, e) {
                var src = e.src ? e.src : e.dataset.src
                if (curSrc == src) {
                    idx = i
                }
                imgUrls.push(src)
            })
            console.log(idx);

            ss.changeImg(imgUrls, idx)
        })

    }
    $(".all").each(function (i, e) {
        var p = $(this).parent().siblings("p")
        var h = p.height()
        var vw = $("body").width() / 100

        if (h > 29.33 * vw) {
            $(this).removeClass("sp-hide")
            $(this).tap(function () {
                if (p.hasClass("show-all")) {
                    $(this).html("全文")
                    p.removeClass("show-all")
                } else {
                    $(this).html("收起")
                    p.addClass("show-all")
                }

            })
        }

    })
})
// 会员卡和商品项
function initGoodItem(data,onlyItem) {
    if(data.length>0){
        $("#item-wrapper").css("display","block")
    }else{
        $("#item-wrapper").css("display","none")
    }
    mySlider = new dySlider("dys2", {
        data: data,
        tap: function (el) {
            var sq=parseFloat(el.dataset.marketprice)-parseFloat(el.dataset.price)
            var sq2=""
            if(el.dataset.vipprice){
                sq2=` <div class="hyksq">
               <img src='http://manage.yihuoshidai.com/files/b67dda14-b368-457a-8418-4bc0ef27bf3f.png'> <span>使用本店会员卡再省${parseFloat(el.dataset.price)-parseFloat(el.dataset.vipprice)}元</span>
            </div>`
            }
            $("#itemName").html(`   <div class="name">${el.dataset.name}</div>
            <div class="jg-wrapper">
                <div class="msj">门市价<span>￥${el.dataset.marketprice}</span>
                </div>
                <div class="lxj">利享价<span>${el.dataset.price}</span></div>
                <div class="sq">省${sq}元</div>
            </div>${sq2}
           `)
      
                $("#itemMansong").html(" <li class=\"item\">\n" +
                "                        <div class=\"text animated swing\">\n" +
                "                            消费 <span>领</span> 2000利享币\n" +
                "                        </div>\n" +
                "                        <div class=\"btn animated shake\">参与活动</div>\n" +
                "                    </li>")
            $("#pic-text").html(' <p><img src="http://manage.yihuoshidai.com/files/b76c0fd1-924a-43bf-8fc9-4d3e2836f222.jpg" style="width: 831px;"><img src="http://manage.yihuoshidai.com/files/0ce50e22-23b4-47e3-9df5-18720a56f1f4.jpg" style="width: 790px;"><img src="http://manage.yihuoshidai.com/files/3e323331-57e8-419b-8bbf-92186222a745.jpg" style="width: 831px;"><img src="http://manage.yihuoshidai.com/files/f896128b-d36d-420c-849b-bd9caedc344a.jpg" style="width: 831px;"><img src="http://manage.yihuoshidai.com/files/11b58282-2dbd-4f36-b4d2-0b259cf28baa.jpg" style="width: 790px;"><img src="http://manage.yihuoshidai.com/files/8ee1ce15-50f6-4fed-bb45-75d9ca29bb67.jpg" style="width: 831px;"><img src="http://manage.yihuoshidai.com/files/2123e925-ed0c-474b-a0da-d1d830fd2e48.jpg" style="width: 831px;"><br></p>')
        }
    })
}
function initMySlider(data, onlyItem) {
    if (onlyItem) {
        initGoodItem(data)
        return
    }

    new dySlider("dys", {
        data:data,
        isVipcard: true,
        tap: function (el) {
            var sq=parseFloat(el.dataset.marketprice)-parseFloat(el.dataset.price)
            $("#cardName").html(` <div class="name">${el.dataset.name}</div>
            <div class="jg-wrapper">
                <div class="msj">门市价<span>￥${el.dataset.marketprice}</span>
                </div>
                <div class="lxj">￥<span>${el.dataset.price}</span></div>
                <div class="sq">省${sq.toFixed(2)}元</div>
            </div>`)
          
          
            $("#cardMansong").html(" <li class=\"item popup-btn\" data-target='#mypanel'>\n" +
                "                        <div class=\"text animated swing\">\n" +
                "                            下单即 <span class='b'>送</span> 2000利享币 \n" +
                "                        </div>\n" +
                "                        <div class=\"btn animated shake\">立即兑换</div>\n" +
                "                    </li>")
          
                $(data).each(function(i,e){
                    if (e.id == el.dataset.id) {
                        initGoodItem(e.list)
                        
                    }
                })
        }
    })
}



function spMore(el){
        var s = $(el).data("target")        
        if (s) {
            if ($(s).css("height") == "unset") {
                $(s).removeAttr("style")
                $(el).html('查看更多&nbsp;<i class="fas fa-angle-down" aria-hidden="true"></i>')
            } else {
                $(s).css("height", "unset")
                $(el).html('收起&nbsp;<i class="fas fa-angle-up" aria-hidden="true"></i>')
            }

        }
}
function showCardDetail(ele){
 
    var mask = document.createElement("div")
    mask.className="shop-mask"
    mask.style.display="block"
    mask.addEventListener("touchstart",function(e){
        e.stopPropagation();
        e.preventDefault();
    },false);
    $("body").append(mask)
    mask.addEventListener("touchend", hide)
    var el=  $("#mypanel")[0]
          el.className += " show" 
 

    function hide(e) {

        var str = document.querySelector(".shop-popup").className.replace(/show/, "")
        document.querySelector(".shop-popup").className = str
       $(this).remove()
    }
}